import numpy as np
from OpenGL.GL import *


class HersheyFont:

    # see the __init__() at the bottom of the file

    def drawText(self,text, xloc, yloc, scale=1, angle=0, slant=0, weight = 3, center = False, justify = -1):

        cosval = np.cos(angle*np.pi/180)
        sinval = np.sin(angle*np.pi/180)
        rotate = [[cosval, sinval], [-sinval, cosval]]

        textlines = self.string_strokes(text)
        textlines = (textlines  * scale/32)
        length = np.amax(textlines[:,0]) - np.amin(textlines[:,0])
        xmid =  ( np.amax(textlines[:,0]) + np.amin(textlines[:,0]) ) /2
        ymid =  ( np.amax(textlines[:,1]) + np.amin(textlines[:,1]) ) /2



        if center :
            textlines -= [xmid, ymid]

        if justify == -1:
            pass
        elif  justify == 0:
            textlines -= [xmid, 0]
        elif justify == 1:
            textlines -= [length, 0]


        if slant != 0:
            textlines[:,0] += textlines[:,1]*slant
        textlines = np.dot(textlines,rotate)
        textlines += [xloc, yloc]

        glLineWidth(weight)
        glBegin(GL_LINES)
        for i in range(0, len(textlines), 2):
            x0, y0 = textlines[i]
            x1, y1 = textlines[i + 1]
            glVertex2f(x0, y0)
            glVertex2f(x1, y1)
        glEnd()


    def string_strokes(self,text, scale=1, angle=0):
        lines = None
        xstart = 0
        for ch in text:
            newlines, size = self.char_strokes(ch)
            if len(newlines) > 0:
                newlines = np.array(newlines, dtype = np.float32) + [xstart, 0]
                if lines is None:
                    lines = newlines
                else:
                    lines = np.vstack((lines, newlines))
            xstart += size
        return lines


    def char_strokes(self, ichar):

        def get_ch(ch_val):
            ch = self.grfdat[ch_val]
            return ch,ch_val+1

        ch_count = self.grloc[ord(ichar) - 32]
        ch1, ch_count = get_ch(ch_count)
        size = ch1 - 64
        lines = []

        while self.grfdat[ch_count] != 254:
            ch1, ch_count = get_ch(ch_count)
            ch2, ch_count = get_ch(ch_count)
            if ch1 == 33: #pick up the pen and move to next location
                ch1 = ch2
                ch2, ch_count = get_ch(ch_count)
                if (ch1 == 254):
                    return lines,size
                x0 = ch1 - 64
                y0 = ch2 - 64
                #Call grMove(x, y)
            else:
                x1 = ch1 - 64
                y1 = ch2 - 64
                #Call grDraw(x, y)
                lines.append([x0,y0])
                lines.append([x1,y1])
                x0=x1
                y0=y1
            #End If

        return lines,size


    def __init__(self):

        self.grloc = [0, 4, 22, 34, 56, 109, 159, 230, 245, 268, 291, 308, 320, 339, 346, 359, 366, 403, 414, 445, 478, 492, 529, 578, 590, 651, 700,
                 724, 754, 763, 775, 784, 826, 882, 899, 946, 985, 1017, 1039, 1056, 1102, 1119, 1126, 1149, 1166, 1178, 1200, 1217, 1262, 1290, 
                 1340, 1373, 1416, 1428, 1451, 1463, 1485, 1497, 1511, 1528, 1539, 1546, 1557, 1566, 1573, 1588, 1624, 1660, 1691, 1727, 1764, 1782, 
                 1828, 1850, 1868, 1892, 1909, 1916, 1953, 1975, 2012, 2048, 2084, 2102, 2139, 2157, 2179, 2191, 2213, 2225, 2245, 2262, 2294, 2301, 
                 2327, 2354]

        self.grfdat = [81, 33, 254, 65, 75, 33, 70, 86, 70, 72, 33, 70, 67, 69, 66, 70, 65, 71, 66, 70, 67, 254, 81, 33, 69, 86, 69, 79, 33, 77, 86, 77, 79, 254, 86, 33, 76, 90, 69, 58, 33, 82, 90,
            75, 58, 33, 69, 77, 83, 77, 33, 68, 71, 82, 71, 254, 85, 33, 73, 90, 73, 61, 33, 77, 90, 77, 61, 33, 82, 83, 80, 85, 77, 86, 73, 86, 70, 85, 68, 83, 68, 81, 69, 79, 70, 78, 72, 77, 78, 75, 80, 74,
            81, 73, 82, 71, 82, 68, 80, 66, 77, 65, 73, 65, 70, 66, 68, 68, 254, 85, 33, 72, 85, 72, 83, 71, 82, 69, 82, 68, 83, 68, 85, 69, 86, 71, 86, 72, 85, 75, 84, 77, 84, 80, 85, 82, 86, 68, 65, 33, 79,
            65, 81, 65, 82, 66, 82, 68, 81, 69, 79, 69, 78, 68, 78, 66, 79, 65, 254, 91, 33, 88, 77, 88, 78, 87, 79, 86, 79, 85, 78, 84, 76, 82, 71, 80, 68, 78, 66, 76, 65, 72, 65, 70, 66, 69, 67, 68, 69, 68,
            71, 69, 73, 70, 74, 77, 78, 78, 79, 79, 81, 79, 83, 78, 85, 76, 86, 74, 85, 73, 83, 73, 81, 74, 78, 76, 75, 81, 68, 83, 66, 85, 65, 87, 65, 88, 66, 88, 67, 254, 74, 33, 69, 79, 70, 82, 70, 85, 69,
            86, 68, 85, 69, 84, 254, 79, 33, 76, 90, 74, 88, 72, 85, 70, 81, 69, 76, 69, 72, 70, 67, 72, 63, 74, 60, 76, 58, 254, 79, 33, 68, 90, 70, 88, 72, 85, 74, 81, 75, 76, 75, 72, 74, 67, 72, 63, 70, 60,
            68, 58, 254, 81, 33, 73, 80, 73, 68, 33, 68, 77, 78, 71, 33, 78, 77, 68, 71, 254, 91, 33, 78, 83, 78, 65, 33, 69, 74, 87, 74, 254, 75, 33, 71, 66, 70, 65, 69, 66, 70, 67, 71, 66,
            71, 64, 70, 62, 69, 61, 254, 91, 33, 69, 74, 87, 74, 254, 75, 33, 70, 67, 69, 66, 70, 65, 71, 66, 70, 67, 254, 87, 33, 85, 90, 67, 58, 254, 85, 33, 74, 86, 71, 85, 69, 82, 68, 77, 68, 74, 69, 69,
            71, 66, 74, 65, 76, 65, 79, 66, 81, 69, 82, 74, 82, 77, 81, 82, 79, 85, 76, 86, 74, 86, 254, 85, 33, 71, 82, 73, 83, 76, 86, 76, 65, 254, 85, 33, 69, 81, 69, 82, 70, 84, 71, 85, 73, 86, 77, 86, 79,
            85, 80, 84, 81, 82, 81, 80, 80, 78, 78, 75, 68, 65, 82, 65, 254, 85, 33, 70, 86, 81, 86, 75, 78, 78, 78, 80, 77, 81, 76, 82, 73, 82, 71, 81, 68, 79, 66, 76, 65, 73, 65, 70, 66, 69, 67, 68, 69, 254,
            85, 33, 78, 86, 68, 72, 83, 72, 33, 78, 86, 78, 65, 254, 85, 33, 80, 86, 70, 86, 69, 77, 70, 78, 73, 79, 76, 79, 79, 78, 81, 76, 82, 73, 82, 71, 81, 68, 79, 66, 76, 65, 73, 65, 70, 66, 69, 67, 68,
            69, 254, 85, 33, 81, 83, 80, 85, 77, 86, 75, 86, 72, 85, 70, 82, 69, 77, 69, 72, 70, 68, 72, 66, 75, 65, 76, 65, 79, 66, 81, 68, 82, 71, 82, 72, 81, 75, 79, 77, 76, 78, 75, 78, 72, 77, 70, 75, 69,
            72, 254, 85, 33, 82, 86, 72, 65, 33, 68, 86, 82, 86, 254, 85, 33, 73, 86, 70, 85, 69, 83, 69, 81, 70, 79, 72, 78, 76, 77, 79, 76, 81, 74, 82, 72, 82, 69, 81, 67, 80, 66, 77, 65, 73, 65, 70, 66, 69,
            67, 68, 69, 68, 72, 69, 74, 71, 76, 74, 77, 78, 78, 80, 79, 81, 81, 81, 83, 80, 85, 77, 86, 73, 86, 254, 85, 33, 81, 79, 80, 76, 78, 74, 75, 73, 74, 73, 71, 74, 69, 76, 68, 79,
            68, 80, 69, 83, 71, 85, 74, 86, 75, 86, 78, 85, 80, 83, 81, 79, 81, 74, 80, 69, 78, 66, 75, 65, 73, 65, 70, 66, 69, 68, 254, 75, 33, 70, 79, 69, 78, 70, 77, 71, 78,
            70, 79, 33, 70, 67, 69, 66, 70, 65, 71, 66, 70, 67, 254, 75, 33, 70, 79, 69, 78, 70, 77, 71, 78, 70, 79, 33, 71, 66, 70, 65, 69, 66, 70, 67, 71, 66, 71, 64, 70, 62, 69, 61, 254, 80, 33,
            77, 65, 68, 75, 77, 86, 254, 91, 33, 69, 77, 87, 77, 33, 69, 71, 87, 71, 254, 80, 33, 68, 65, 77, 75, 68, 86, 254, 83, 33, 68, 81, 68, 82, 69, 84, 70, 85, 72, 86, 76, 86, 78, 85, 79, 84,
            80, 82, 80, 80, 79, 78, 78, 77, 74, 75, 74, 72, 33, 74, 67, 73, 66, 74, 65, 75, 66, 74, 67, 254, 90, 33, 84, 65, 75, 65, 72, 66, 69, 69, 68, 72, 68, 79, 69, 82, 72, 85, 75, 86, 81, 86,
            83, 85, 86, 82, 87, 79, 87, 70, 86, 69, 83, 69, 82, 70, 82, 82, 33, 82, 80, 80, 82, 75, 82, 73, 80, 73, 72, 75, 70, 80, 70, 82, 72, 254, 83, 33, 74, 86, 66, 65, 33, 74, 86, 82, 65, 33,
            69, 72, 79, 72, 254, 86, 33, 69, 86, 69, 65, 33, 69, 86, 78, 86, 81, 85, 82, 84, 83, 82, 83, 80, 82, 78, 81, 77, 78, 76, 33, 69, 76, 78, 76, 81, 75, 82, 74, 83, 72, 83, 69, 82, 67, 81,
            66, 78, 65, 69, 65, 254, 86, 33, 83, 81, 82, 83, 80, 85, 78, 86, 74, 86, 72, 85, 70, 83, 69, 81, 68, 78, 68, 73, 69, 70, 70, 68, 72, 66, 74, 65, 78, 65, 80, 66, 82, 68, 83, 70, 254, 86,
            33, 69, 86, 69, 65, 33, 69, 86, 76, 86, 79, 85, 81, 83, 82, 81, 83, 78, 83, 73,
            82, 70, 81, 68, 79, 66, 76, 65, 69, 65, 254, 84, 33, 69, 86, 69, 65, 33, 69, 86, 82, 86, 33, 69, 76, 77, 76, 33, 69, 65, 82, 65, 254, 83, 33, 69, 86, 69, 65,
            33, 69, 86, 82, 86, 33, 69, 76, 77, 76, 254, 86, 33, 83, 81, 82, 83, 80, 85, 78, 86, 74, 86, 72, 85, 70, 83, 69, 81, 68, 78, 68, 73, 69, 70, 70, 68, 72, 66, 74, 65, 78, 65, 80, 66, 82, 68,
            83, 70, 83, 73, 33, 78, 73, 83, 73, 254, 87, 33, 69, 86, 69, 65, 33, 83, 86, 83, 65, 33, 69, 76, 83, 76, 254, 73, 33, 69, 86, 69, 65, 254, 81, 33, 77, 86, 77, 70, 76, 67, 75, 66, 73, 65, 71,
            65, 69, 66, 68, 67, 67, 70, 67, 72, 254, 86, 33, 69, 86, 69, 65, 33, 83, 86, 69, 72, 33, 74, 77, 83, 65, 254, 82, 33, 69, 86, 69, 65, 33, 69, 65, 81, 65, 254, 89, 33, 69, 86, 69, 65, 33, 69,
            86, 77, 65, 33, 85, 86, 77, 65, 33, 85, 86, 85, 65, 254, 87, 33, 69, 86, 69, 65, 33, 69, 86, 83, 65, 33, 83, 86, 83, 65, 254, 87, 33, 74, 86, 72, 85, 70, 83, 69, 81, 68, 78, 68, 73, 69, 70,
            70, 68, 72, 66, 74, 65, 78, 65, 80, 66, 82, 68, 83, 70, 84, 73, 84, 78, 83, 81, 82, 83, 80, 85, 78, 86, 74, 86, 254, 86, 33, 69, 86, 69, 65, 33, 69, 86, 78, 86, 81, 85, 82, 84, 83, 82, 83,
            79, 82, 77, 81, 76, 78, 75, 69, 75, 254, 87, 33, 74, 86, 72, 85, 70, 83, 69, 81, 68, 78, 68, 73, 69, 70, 70, 68, 72, 66, 74, 65, 78, 65, 80, 66, 82, 68, 83, 70, 84, 73, 84, 78, 83, 81, 82,
            83, 80, 85, 78, 86, 74, 86, 33, 77, 69, 83, 63, 254, 86, 33,
            69, 86, 69, 65, 33, 69, 86, 78, 86, 81, 85, 82, 84, 83, 82, 83, 80, 82, 78, 81, 77, 78, 76, 69, 76, 33, 76, 76, 83, 65, 254, 85, 33, 82, 83, 80, 85, 77, 86, 73, 86, 70,
            85, 68, 83, 68, 81, 69, 79, 70, 78, 72, 77, 78, 75, 80, 74, 81, 73, 82, 71, 82, 68, 80, 66, 77, 65, 73, 65, 70, 66, 68, 68, 254, 81, 33, 73, 86, 73, 65, 33, 66, 86, 80, 86, 254, 87, 33, 69,
            86, 69, 71, 70, 68, 72, 66, 75, 65, 77, 65, 80, 66, 82, 68, 83, 71, 83, 86, 254, 83, 33, 66, 86, 74, 65, 33, 82, 86, 74, 65, 254, 89, 33, 67, 86, 72, 65, 33, 77, 86, 72, 65, 33, 77, 86, 82,
            65, 33, 87, 86, 82, 65, 254, 85, 33, 68, 86, 82, 65, 33, 82, 86, 68, 65, 254, 83, 33, 66, 86, 74, 76, 74, 65, 33, 82, 86, 74, 76, 254, 85, 33, 82, 86, 68, 65, 33, 68, 86, 82, 86, 33, 68, 65,
            82, 65, 254, 75, 33, 72, 65, 68, 65, 68, 86, 72, 86, 254, 87, 33, 85, 58, 67, 90, 254, 75, 33, 68, 65, 72, 65, 72, 86, 68, 86, 254, 85, 33, 82, 82, 75, 86, 68, 82, 254, 87, 33, 84, 65, 68,
            65, 254, 71, 33, 68, 80, 67, 83, 67, 85, 68, 86, 69, 85, 68, 84, 254, 84, 33, 80, 79, 80, 65, 33, 80, 76, 78, 78, 76, 79, 73, 79, 71, 78, 69, 76, 68, 73, 68, 71, 69, 68, 71, 66, 73, 65, 76,
            65, 78, 66, 80, 68, 254, 84, 33, 69, 86, 69, 65, 33, 69, 76, 71, 78, 73, 79, 76, 79, 78, 78, 80, 76, 81, 73, 81, 71, 80, 68, 78, 66, 76, 65, 73, 65, 71, 66, 69, 68, 254, 83, 33, 80, 76, 78,
            78, 76, 79, 73, 79, 71, 78, 69, 76, 68, 73, 68, 71,
            69, 68, 71, 66, 73, 65, 76, 65, 78, 66, 80, 68, 254, 84, 33, 80, 86, 80, 65, 33, 80, 76, 78, 78, 76, 79, 73, 79, 71, 78, 69, 76, 68, 73, 68, 71, 69, 68, 71, 66, 73, 65, 76, 65,
            78, 66, 80, 68, 254, 83, 33, 68, 73, 80, 73, 80, 75, 79, 77, 78, 78, 76, 79, 73, 79, 71, 78, 69, 76, 68, 73, 68, 71, 69, 68, 71, 66, 73, 65, 76, 65, 78, 66, 80, 68, 254, 77, 33,
            75, 86, 73, 86, 71, 85, 70, 82, 70, 65, 33, 67, 79, 74, 79, 254, 84, 33, 80, 79, 80, 63, 79, 60, 78, 59, 76, 58, 73, 58, 71, 59, 33, 80, 76, 78, 78, 76, 79, 73, 79, 71, 78, 69, 76, 68, 73,
            68, 71, 69, 68, 71, 66, 73, 65, 76, 65, 78, 66, 80, 68, 254, 84, 33, 69, 86, 69, 65, 33, 69, 75, 72, 78, 74, 79, 77, 79, 79, 78, 80, 75, 80, 65, 254, 73, 33, 68, 86, 69, 85, 70, 86, 69, 87,
            68, 86, 33, 69, 79, 69, 65, 254, 75, 33, 70, 86, 71, 85, 72, 86, 71, 87, 70, 86, 33, 71, 79, 71, 62, 70, 59, 68, 58, 66, 58, 254, 82, 33, 69, 86, 69, 65, 33, 79, 79, 69, 69, 33, 73, 73, 80,
            65, 254, 73, 33, 69, 86, 69, 65, 254, 95, 33, 69, 79, 69, 65, 33, 69, 75, 72, 78, 74, 79, 77, 79, 79, 78, 80, 75, 80, 65, 33, 80, 75, 83, 78, 85, 79, 88, 79, 90, 78, 91, 75, 91, 65, 254, 84,
            33, 69, 79, 69, 65, 33, 69, 75, 72, 78, 74, 79, 77, 79, 79, 78, 80, 75, 80, 65, 254, 84, 33, 73, 79, 71, 78, 69, 76, 68, 73, 68, 71, 69, 68, 71, 66, 73, 65, 76, 65, 78, 66, 80, 68, 81, 71, 81,
            73, 80, 76, 78, 78, 76, 79, 73, 79, 254, 84, 33,
            69, 79, 69, 58, 33, 69, 76, 71, 78, 73, 79, 76, 79, 78, 78, 80, 76, 81, 73, 81, 71, 80, 68, 78, 66, 76, 65, 73, 65, 71, 66, 69, 68, 254, 84, 33, 80, 79, 80, 58, 33, 80, 76, 78, 78,
            76, 79, 73, 79, 71, 78, 69, 76, 68, 73, 68, 71, 69, 68, 71, 66, 73, 65, 76, 65, 78, 66, 80, 68, 254, 78, 33, 69, 79, 69, 65, 33, 69, 73, 70, 76, 72, 78, 74, 79, 77, 79, 254, 82, 33, 79, 76, 78, 78,
            75, 79, 72, 79, 69, 78, 68, 76, 69, 74, 71, 73, 76, 72, 78, 71, 79, 69, 79, 68, 78, 66, 75, 65, 72, 65, 69, 66, 68, 68, 254, 77, 33, 70, 86, 70, 69, 71, 66, 73, 65, 75, 65, 33, 67, 79, 74, 79, 254,
            84, 33, 69, 79, 69, 69, 70, 66, 72, 65, 75, 65, 77, 66, 80, 69, 33, 80, 79, 80, 65, 254, 81, 33, 67, 79, 73, 65, 33, 79, 79, 73, 65, 254, 87, 33, 68, 79, 72, 65, 33, 76, 79, 72, 65, 33, 76, 79, 80,
            65, 33, 84, 79, 80, 65, 254, 82, 33, 68, 79, 79, 65, 33, 79, 79, 68, 65, 254, 81, 33, 67, 79, 73, 65, 33, 79, 79, 73, 65, 71, 61, 69, 59, 67, 58, 66, 58, 254, 82, 33, 79, 79, 68, 65, 33, 68, 79, 79,
            79, 33, 68, 65, 79, 65, 254, 76, 33, 74, 65, 72, 65, 70, 67, 70, 74, 69, 75, 67, 75, 33, 69, 75, 33, 70, 76, 33, 69, 75, 70, 76, 70, 84, 72, 86, 74, 86, 254, 71, 33, 68, 86, 68, 65, 254, 78, 33, 67,
            65, 71, 65, 73, 67, 73, 74, 74, 75, 76, 75, 33, 74, 75, 73, 76, 73, 84, 71, 86, 67, 86, 254, 89, 33, 86, 79, 86, 77, 85, 75, 83, 74, 80, 74, 78, 75, 76, 79, 74, 80, 71, 80, 69, 79, 68, 77,
            68, 75, 254, 94, 254, 54, 139, 71, 246, 80, 139, 94, 254]

def main():
    hf=HersheyFont()
    ss = hf.string_strokes("Hello World!")
    print(ss)

if __name__ == "__main__":
    main()